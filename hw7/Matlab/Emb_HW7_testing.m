h = fir1(28,8/24);
fliplr(h)
figure
subplot(4,2,1)
stem(h)
xlabel('time')
ylabel('magnitude')
title('FIR LPF')
subplot(4,2,2)
H = fft(h);
H = fftshift(H);
stem(abs(H))
xlabel('frequency')
ylabel('magnitude')
title('FIR LPF')

sensor = [-7.000, -11.000, -41.000, -278.000, -34.000, -36.000, +30.000, +137.000, +176.000, -27.000, -38.000, -250.000, -87.000, 0.000, -113.000, -193.000, +94.000, +233.000, +46.000, -94.000, -3.000, +2.000, 0.000, -2.000, -1.000, -5.000, 0.000, 0.000, -1.000, +290.000, +7.000, -20.000, +80.000, +72.000, -10.000, -7.000, -48.000, -183.000, -130.000, +62.000, +257.000, +246.000, +200.000, +116.000, +38.000, -254.000, -198.000, -8.000, -102.000, -124.000, +22.000, -70.000, -1.000, +237.000, +160.000, +113.000, -27.000, -85.000, -90.000, -2.000, -217.000, -138.000, -50.000, -31.000, +173.000, +24.000, +299.000, +54.000, -17.000, -123.000, -171.000, -131.000, -215.000, -13.000, +221.000, +201.000, +75.000, +110.000, +53.000, +35.000, -131.000, -113.000, -14.000, -142.000, -50.000, +225.000, +39.000, +170.000, +132.000, -200.000, -172.000, -75.000, -187.000, +38.000, +178.000, +87.000, +178.000, -16.000, -209.000, -34.000, -192.000, -201.000, +218.000, +260.000, +48.000, +119.000, +154.000, -100.000, -187.000, -103.000, -197.000, -102.000, +79.000, +229.000, +95.000, +280.000, -127.000, -317.000, -169.000, -171.000, -47.000, +376.000, +211.000, +178.000, -67.000, -250.000, -234.000, -49.000, +310.000, +40.000, +46.000, +162.000, -270.000, -119.000, -30.000, -1.000, -57.000, +259.000, +136.000, -7.000, -97.000, -85.000, -214.000, -192.000, +206.000, +353.000, +107.000, -22.000, +4.000, +52.000, +41.000, -111.000, -46.000, -120.000, +9.000, +389.000, +250.000, +225.000, -177.000, -213.000, -317.000, -10.000, +322.000, +214.000, -184.000, -440.000, -253.000, -98.000, +257.000, +14.000, +106.000, +93.000, +99.000, -176.000, -335.000, -313.000, +18.000, +421.000, +84.000, +100.000, -169.000, -154.000, -199.000, +18.000, +267.000, +348.000, +277.000, -182.000, -263.000, -343.000, -69.000, +301.000, +214.000, +253.000, -129.000, -455.000, -296.000, -62.000, +278.000, +235.000, +306.000, -46.000, -473.000, -364.000, -29.000, +175.000, +270.000, +166.000, +168.000, -61.000, -320.000, -284.000, -207.000, +68.000, +157.000, +326.000, +230.000, +259.000, +63.000, -145.000, -267.000, -317.000, -269.000, -111.000, +59.000, +160.000, +277.000, +40.000, +224.000, +228.000, +58.000, -259.000, -273.000, -238.000, -285.000, +5.000, +147.000, +475.000, +358.000, +250.000, +66.000, -217.000, -516.000, -464.000, -231.000, +448.000, +380.000, +209.000, +275.000, -242.000, -377.000, -310.000, -327.000, -82.000, +482.000, +305.000, +307.000, -130.000, +99.000, +318.000, +230.000, +274.000, +343.000, +284.000, +269.000, -237.000, -208.000, -254.000, +174.000, +117.000, -2.000, +1.000, -291.000, -100.000, +223.000, +347.000, +446.000, -218.000, -345.000, -29.000, -298.000, -235.000, +242.000, +511.000, +9.000, -3.000, -105.000, +178.000, +102.000, +80.000, -167.000, -377.000, -308.000, -242.000, -109.000, +457.000, +67.000, +397.000, +264.000, -339.000, -532.000, -100.000, -331.000, -330.000, +311.000, +361.000, +146.000, +427.000, +291.000, -308.000, -522.000, -169.000, -325.000, -255.000, +330.000];
subplot(4,2,3)
plot(sensor)
xlabel('time')
ylabel('magnitude')
title('sensor data')

subplot(4,2,4)
X = fft(sensor);
X = fftshift(X);
stem(abs(X))
xlabel('frequency')
ylabel('magnitude')
title('sensor data')

y = conv(h,sensor);
y = y(1:315);
subplot(4,2,5)
plot(y)
xlabel('time')
ylabel('magnitude')
title('the output from MATLAB')

Y = fft(y);
Y = fftshift(Y);
subplot(4,2,6)
stem(abs(Y))
xlabel('frequency')
ylabel('magnitude')
title('the output of MATLAB')

testOutput = [-0.010998, -0.030833, -0.085710, -0.484582, -0.493273, 0.139024, 1.410799, 2.047945, 0.090725, -4.352593, -6.500971, -1.183501, 10.681066, 16.723803, -0.533027, -47.414993, -105.593697, -137.426178, -111.020821, -28.550581, 67.567703, 121.198357, 102.630020, 26.853640, -63.030720, -127.746040, -150.051010, -131.029495, -79.750420, -10.980440, 50.472191, 78.365623, 62.353424, 18.995554, -17.657543, -25.367088, -11.165431, 0.559856, -3.058201, -10.291349, 0.549689, 33.804230, 70.684502, 87.624382, 79.678009, 62.481628, 52.785202, 46.226788, 20.159744, -37.501236, -103.912010, -129.519882, -74.681908, 52.248890, 190.058868, 262.107391, 226.598709, 103.904602, -39.210926, -134.629349, -157.553085, -131.074417, -96.272331, -73.299500, -48.872036, -0.795025, 70.343475, 131.620453, 145.660004, 102.498779, 26.676968, -46.044666, -95.961884, -123.750404, -134.346756, -122.817360, -77.335770, 2.704560, 94.013756, 158.743134, 165.204193, 104.624466, -3.520223, -117.986900, -190.922852, -188.411728, -110.077301, 9.567120, 117.715523, 172.691803, 164.341904, 111.976639, 43.964539, -19.994696, -72.089737, -106.824562, -110.161736, -69.455856, 10.932776, 100.099167, 150.988510, 129.279877, 37.567955, -81.601105, -166.957016, -172.978897, -96.367393, 23.252642, 125.551476, 159.858566, 108.437057, -3.317446, -118.507286, -177.656204, -149.766800, -47.831676, 77.055428, 168.228668, 191.614243, 145.137100, 51.731789, -56.348904, -148.227066, -192.811554, -165.618408, -64.259331, 76.983597, 190.154037, 206.693588, 102.485901, -75.942169, -228.827942, -259.922668, -139.688705, 65.628250, 231.143890, 254.190002, 125.310883, -65.010193, -189.331253, -173.548737, -43.747562, 100.972595, 164.525055, 116.433937, 0.606870, -107.368958, -149.129196, -109.501228, -13.739440, 90.289162, 150.646912, 130.158386, 30.215343, -98.227005, -176.467484, -150.606293, -33.082386, 102.720352, 177.858856, 166.455627, 104.476212, 41.762218, -3.854162, -46.368435, -88.766716, -95.285645, -20.677847, 125.509010, 253.722610, 255.777863, 104.673401, -102.322876, -213.775497, -152.515427, 12.880745, 126.762047, 83.463921, -85.025078, -242.985092, -270.292175, -150.441162, 34.601856, 175.244461, 200.966446, 105.435120, -61.449520, -212.960037, -260.891235, -166.664368, 20.205919, 180.511169, 203.402908, 72.418755, -115.608459, -216.724930, -145.141983, 59.753025, 258.444519, 305.840515, 158.169647, -90.684677, -268.535614, -248.198730, -45.692017, 185.336990, 266.506226, 130.371231, -126.319092, -312.094177, -285.698151, -62.621902, 194.573425, 299.162323, 177.997803, -78.107727, -287.203247, -309.354797, -138.290573, 107.168839, 273.602722, 270.733795, 113.719337, -100.697174, -258.910858, -288.787781, -185.118362, -1.456031, 183.619980, 299.755493, 309.772369, 214.364365, 46.767277, -136.733032, -271.894196, -310.052368, -243.459335, -109.446732, 33.394608, 141.177109, 201.691177, 222.059067, 203.615799, 135.035919, 9.864595, -146.683578, -276.801666, -314.729431, -225.555298, -28.925905, 206.976822, 387.567444, 425.396484, 281.599518, -0.352799, -296.756958, -455.438599, -386.114868, -120.083565, 198.778900, 396.533112, 369.205353, 138.120575, -167.290649, -382.961426, -399.701416, -220.366119, 46.020668, 254.415100, 313.749878, 238.350327, 124.442703, 74.418480, 130.542191, 255.304779, 364.078552, 376.624329, 263.076569, 68.513496, -107.859810, -172.393768, -105.679832, 13.869925, 70.396805, 13.429706, -92.206383, -123.782814, -17.302856, 166.079788, 284.284760, 229.817062, 20.649534, -209.587814, -310.886078, -224.481934, -20.361044, 161.391022, 218.873047, 156.327682, 62.778969, 26.198488, 55.980469, 79.009422, 16.566702, -136.210968, -296.523956, -351.451111, -243.762833, -15.109379, 219.820755, 340.508392, 287.031189, 87.154060, -162.443939, -350.647339];
subplot(4,2,7)
plot(testOutput)
xlabel('time')
ylabel('magnitude')
title('the ouput of CMSIS-DSP')

TEST = fft(testOutput);
TEST = fftshift(TEST);
subplot(4,2,8)
stem(abs(TEST))
xlabel('time')
ylabel('magnitude')
title('the ouput of CMSIS-DSP')

